# Haccess simple tool example configuration file
#
# Ben Dooks <ben@hacman.org.uk> <ben@fluff.org>

# This example is a simple tool configuration that does not need
# any authentication. The haccess node allows the tool to be turned
# on, and off. The sources for on/off are either the two buttons on
# the front, or via mqtt control (such as space off or emergency stop)


[mqtt]
server=mqtt.hacman.org.uk
port=1883

# no need to run auth
[auth]
rfid=false
cache=false


[input1]
type=mqtt_in
name=mqtt/emergency_stop
topic=tool/emergency_stop
default=false

[input2]
type=mqtt_in
name=mqtt/workshop_shutdown
topic=workshop_shutdown

[input3]
type=mqtt_in
name=mqtt/hackspace_shutdown
topic=hackspace_shutdown

# logic nodes

# note, the emergency stop should probably have some form of persitence
# behind it, so you can't defeat it by simply powering the unit down and
# then up again
[logic1]
type=not
name=logic/no_emergency_stop
source1=mqtt/emergency_stop

[logic_shutdown]
type=or
name=logic/shutdown
source1=mqtt/workshop_shutdown
source2=mqtt/hackspace_shutdown
source3=input/button2

[logic2]
type=sr
name=logic/user_on
set=input/button1
clear=logic/shutdown

# output is on if /all/ conditions are met for it to be on
[logic_out]
type=and
name=logic/on
source1=logic/no_emergency_stop
source2=logic/user_on

# create the dependencies (mostly for logic to standard outputs)

[dependency1]
target=output/opto
source1=logic/on
